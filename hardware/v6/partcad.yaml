name: /pub/medical/laboratory/4tvc-microlab/v6
desc: The latest version Microlab by Four Thieves Vinegar Collective.
cover:
  assembly: microlab

docs:
  intro: |
    This is a [PartCAD](https://partcad.org/) package for MicroLab.
    It is intended to maintain the information about all the parts
    for the following purposes: manufacturing, procurement and assembly
    (both manual and automated assembly instructions).

    *DISCLAIMER: PartCAD is still under heavy development, and so is
    the PartCAD package for Microlab. Please, consider contributing to
    both PartCAD and this package, but do not yet use this package
    for manufacturing or ordering Microlab parts.*

{% from 'urls.j2' import url_prefix %}
{% set url = url_prefix + '/v6' %}

{% set sizes = [46, 60, 74, 80] %}
{% set sketch_sizes = [45, 46, 59, 60, 73, 74, 79, 80] %}

sketches:
  {% for size in sketch_sizes %}
  m{{ size }}:
    type: basic
    circle: {{ size / 2.0 }}  # radius
  {% endfor %}
  ring-5-3:
    desc: Ring with 5 mm outer radius and 3 mm inner radius
    type: basic
    circle: 5
    inner:
      circle: 3

interfaces:
  {% for size in sizes %}
  m{{ size }}:
    desc: Abstract {{ size }} mm circular interface
    abstract: True
    ports:
      m{{ size }}:
        location: [[0, 0, 0], [0, 0, 1], 0] # redundant, for demonstration
        sketch: m{{ size }}

  m{{ size }}-opening:
    desc: Abstract {{ size }} mm circular opening
    inherits:
      m{{ size }}: opening

  m{{ size }}-jar-mouth:
    desc: Jar mouth (inner opening) with {{ size }} mm diameter
    inherits: 
      m{{ size }}-opening: jar-mouth

  m{{ size }}-threaded-opening:
    # TODO: desc: ...
    ports:
      m{{ size }}-threaded:
        location: [[0, 0, 0], [0, 0, 1], 0] # redundant, for demonstration
        sketch: m{{ size - 1}}

  m{{ size }}-jar-threaded-lid:
    # TODO: desc: ...
    inherits: 
      m{{ size }}-threaded-opening: jar-lid
  
  m{{ size }}-shaft:
    desc: Abstract {{ size }} mm shaft
    inherits:
      m{{ size }}: shaft
    mates:
      - m{{ size }}-opening
  
  m{{ size }}-jar-closing:
    inherits: 
      m{{ size }}-shaft: jar-closing
    mates:
      - m{{ size }}-jar-mouth  
  
  m{{ size }}-threaded-shaft:
    desc: Threaded shaft with {{ size }} mm outer diameter
    inherits:
      m{{ size }}-shaft: threaded
    mates:
      - m{{ size }}-threaded-opening
  
  m{{ size }}-jar-threaded-top:
    desc: Threaded top of a cylindric jar with {{ size }} mm outer diameter
    inherits: 
      m{{ size }}-threaded-shaft: jar-top
  {% endfor %}

parts:
  # Control Unit
  control-box:
    desc: Regular size control box
    type: step
    fileFrom: url
    fileUrl: {{ url }}/control-box/control-box-v.1.1.step
    implements:
      "/pub/std/metric/m:m3-thru":
        outer-left: [[3, 3, 75], [1, 0, 0], 180]
        outer-right: [[205, 3, 75], [1, 0, 0], 180]
        inner-left: [[3, 3, 69.5], [1, 0, 0], 0]
        inner right: [[205, 3, 69.5], [1, 0, 0], 0]
    ports:
      rpi: [[8, 36, 51], [-0.71, -0.71, 0], 180]
      uno: [[131.5, 39.5, 8], [0.71, 0.71, 0], 180]
  control-box-lid:
    desc: Control box lid for regular size control box
    type: step
    fileFrom: url
    # TODO(clairbee): Update the fileUrl to the correct file once it is fixed
    fileUrl: {{ url }}/control-box/control-box-lid-v.1.0.step
    # fileUrl: {{ url }}/control-box/control-box-lid-flat-v.1.0.step
    implements:
      "/pub/std/metric/m:m3-thru":
        outer-left: [[-101, -47, 4], [1, 0, 0], 180]
        outer-right: [[101, -47, 4], [1, 0, 0], 180]
        inner-left: [[-101, -47, 0], [1, 0, 0], 0]
        inner-right: [[101, -47, 0], [1, 0, 0], 0]
  control-box-flat:
    desc: Low profile control box
    type: step
    fileFrom: url
    fileUrl: {{ url }}/control-box/control-box-flat-v.1.0.step
    implements:
      "/pub/std/metric/m:m3-thru":
        outer-left: [[3, 3, 44], [1, 0, 0], 180]
        outer-right: [[185, 3, 44], [1, 0, 0], 180]
        inner-left: [[3, 3, 33], [1, 0, 0], 0]
        inner-right: [[185, 3, 33], [1, 0, 0], 0]
    ports:
      rpi: [[8, 22.5, 20], [-0.71, -0.71, 0], 180]
      uno: [[179.5, 92, 8], [0, 1, 0], 180]
  control-box-lid-flat:
    desc: Control box lid for low profile control box
    type: step
    fileFrom: url
    fileUrl: {{ url }}/control-box/control-box-lid-flat-v.1.0.step
    implements:
      "/pub/std/metric/m:m3-thru":
        outer-left: [[-91, -89, 4], [1, 0, 0], 180]
        outer-right: [[91, -89, 4], [1, 0, 0], 180]
        inner-left: [[-91, -89, 0], [1, 0, 0], 0]
        inner-right: [[91, -89, 0], [1, 0, 0], 0]
  relay-case-no-top:
    desc: Relay board case without a top cover
    type: step
    fileFrom: url
    fileUrl: {{ url }}/control-box/sub-components/relay-board-case-50x73x17mm-no-top.step
  relay-case:
    desc: Relay board case with a top cover
    type: step
    fileFrom: url
    fileUrl: {{ url }}/control-box/sub-components/relay-case-50x73x17mm.step
  stepdown-case:
    desc: A case fir 12V-to-5V stepdown converter
    type: step
    fileFrom: url
    fileUrl: {{ url }}/control-box/sub-components/stepdown-case-63x27x14mm.step
  
  # -------- Reactor Unit --------

  # Pumps box
  pumps-box:
    desc: Pumps box
    type: step
    fileFrom: url
    fileUrl: {{ url }}/pumps-box/pumps-box-v.1.0-rotated.step
    implements:
      "/pub/std/metric/m:m3-thru":
        upper-left: [[5, 64, 183], [1, 0, 0], 90]
        # TODO: commented out as not used so far, but may be needed later, or deleted
        # upper-right: [[183, 64, 183], [1, 0, 0], 90]
        # lower-left: [[5, 64, 5], [1, 0, 0], 90]
        # lower-right: [[183, 64, 5], [1, 0, 0], 90]
        pump-x-upper-left: [[12.5, 0, 179], [1, 0, 0], -90]
        pump-y-upper-left: [[75, 0, 179], [1, 0, 0], -90]
        pump-z-upper-left: [[137.5, 0, 179], [1, 0, 0], -90]
      # TODO: simplification here, concrete mounting to be elaborated
      "/pub/std/metric/m:m24-thru":
        heat-pump-opening: [[4, 19, 64], [0, 1, 0], 90]
        cool-pump-opening: [[184, 19, 64], [0, 1, 0], -90]        
  pumps-box-lid:
    desc: Lid for pumps box
    type: step
    fileFrom: url
    fileUrl: {{ url }}/pumps-box/pumps-box-lid-v0.3-rotated.step
    implements:
      "/pub/std/metric/m:m3-thru":
        upper-left-back: [[5, 4, 183], [1, 0, 0], 90]
        upper-right-back: [[183, 4, 183], [1, 0, 0], 90]
        lower-left-back: [[5, 4, 5], [1, 0, 0], 90]
        lower-right-back: [[183, 4, 5], [1, 0, 0], 90]
        upper-left-front: [[5, 0, 183], [1, 0, 0], -90]
        # TODO: commented out as not used so far, but may be needed later, or deleted
        # upper-right-front: [[183, 0, 183], [1, 0, 0], -90]
        # lower-left-front: [[5, 0, 5], [1, 0, 0], -90]
        # lower-right-front: [[183, 0, 5], [1, 0, 0], -90]
  peristaltic-pump:
    desc: Peristaltic pump (model Intllab DP-520-48S)
    type: step
    fileFrom: url
    fileUrl: {{ url }}/pumps-box/peristaltic-pump.step
    implements:        
      "/pub/std/metric/m:m3-thru":
        upper-left-back: [[-26.75, 20.5, 18.75], [1, 0, 0], 90]
        upper-right-back: [[27.25, 20.5, 18.75], [1, 0, 0], 90]
        lower-left-back: [[-26.75, 20.5, -18.75], [1, 0, 0], 90]
        lower-right-back: [[27.25, 20.5, -18.75], [1, 0, 0], 90]
        upper-left-front: [[-26.75, 15.5, 18.75], [1, 0, 0], -90]
        upper-right-front: [[27.25, 15.5, 18.75], [1, 0, 0], -90]
        lower-left-front: [[-26.75, 15.5, -18.75], [1, 0, 0], -90]
        lower-right-front: [[27.25, 15.5, -18.75], [1, 0, 0], -90]
  circulation-pump:
    desc: Circulation pump (https://www.amazon.com/dp/B09XH1GYYQ)
    type: step
    fileFrom: url
    fileUrl: {{ url }}/pumps-box/circulation-pump.step
    implements:
      # TODO: describe proper mounting
      "/pub/std/metric/m:m24-shaft":
        mount: [[0, 0, 52], [1, 0, 0], 0]

  # Reactor stand
  stand-part-h:
    desc: Reactor stand "H" part
    type: step
    fileFrom: url
    fileUrl: {{ url }}/reactor-stand/reactor-stand-H.v1.0-rotated.step
    implements:
      # TODO: there might be more fitting interface
      "/pub/std/metric/m:m10-thru":
        eye-back-upper: [[13, 175, 134], [1, 1, 0], 180]
        eye-back-lower: [[13, 175, 10], [1, 1, 0], 180]
        eye-front-1: [[13, 10, 151.5], [1, 1, 0], 180]
        eye-front-2: [[13, 38.5, 151.5], [1, 1, 0], 180]
  stand-part-a:
    desc: Reactor stand "A" part
    type: step
    fileFrom: url
    fileUrl: {{ url }}/reactor-stand/reactor-stand-A.v1.0.step
    implements:
      # TODO: there might be more fitting interface
      "/pub/std/metric/m:m10-shaft":
        hook-left-upper: [[57, 9, 54], [0, 0, 1], 180]
        hook-left-lower: [[57, 9, -70], [0, 0, 1], 180]
        hook-right-upper: [[-113.5, 9, -44], [0, 0, 1], 0]
        hook-right-lower: [[-113.5, 9, -70], [0, 0, 1], 0]
  stand-part-c:
    desc: Reactor stand "Â¢" part
    type: step
    fileFrom: url
    fileUrl: {{ url }}/reactor-stand/reactor-stand-c.v1.0.step
    implements:
      # TODO: there might be more fitting interface
      "/pub/std/metric/m:m10-shaft":
        hook-back-right: [[-113.5, 145.5, 72], [0, 0, 1], 180]
        hook-front-right: [[-113.5, 174, 72], [0, 0, 1], 180]
        hook-back-left: [[57, 145.5, 72], [0, 0, 1], 180]
        hook-front-left: [[57, 174, 72], [0, 0, 1], 180]
  stand-part-k:
    desc: Reactor stand "k" part
    type: step
    fileFrom: url
    fileUrl: {{ url }}/reactor-stand/reactor-stand-k.v1.0.step
    implements:
      # TODO: there might be more fitting interface
      "/pub/std/metric/m:m10-thru":
        eye-back-upper: [[-113.5, 9, -44], [1, 1, 0], 180]
        eye-back-lower: [[-113.5, 9, -70], [1, 1, 0], 180]
        eye-front-1: [[-113.5, 145.5, 71.5], [1, 1, 0], 180]
        eye-front-2: [[-113.5, 174, 71.5], [1, 1, 0], 180]
  stand-jar-flange:
    desc: Jar flange holding reactor core on stand
    type: step
    fileFrom: url
    fileUrl: {{ url }}/reactor-stand/reactor-stand-jar-flange.v0.1.step
    implements:
      "m80-opening":
        base: [[0, 1.5, 0], [1, 0, 0], 90]

  # Reactor core
  reactor-core-manifold-core:
    desc: Reactor core manifold - core part
    type: step
    fileFrom: url
    fileUrl: {{ url }}/reactor-manifold/reactor-manifold-core-v0.1.step
    implements:
      # TODO: a different interface most probably
      "m60-jar-closing":
        base: [[0, 0, -54], [1, 0, 0], 180]
      # TODO: check this and next interface - do the holes have thread
      "/pub/std/metric/m:m3-hole-10":
        side-back: [[0, 21.5, -12], [1, 0, 0], -90]
        side-left: [[-18.6, -10.7, -12], [-0.5, 0.866, 0], -90]
        side-right: [[18.6, -10.7, -12], [0.5, 0.866, 0], 90]
      "/pub/std/metric/m:m3-hole-20":
        top-back: [[0, 13, 0], [1, 0, 0], 180]
        top-left: [[-11.25, -6.5, 0], [1, 0, 0], 180]
        top-right: [[11.25, -6.5, 0], [1, 0, 0], 180]
  reactor-core-manifold-lid:
    desc: Reactor core manifold - lid part
    type: step
    fileFrom: url
    fileUrl: {{ url }}/reactor-manifold/reactor-manifold-lid-v0.1.step
    implements:
      "m74-jar-closing":
        top: [[0, 0, 0], [1, 0, 0], 0]
      "/pub/std/metric/m:m3-thru":
        back-inner: [[-21.5, 0, 12], [0.7071, 0, 0.7071], 180]
        # TODO: add other 2 inner interfaces when needed
        back-outer: [[-26.5, 0, 12], [0, 1, 0], 90]
        left-outer: [[13.25, 23, 12], [-0.866, 0.5, 0], -90]
        right-outer: [[13.25, -23, 12], [0.866, 0.5, 0], -90]
  reactor-core-outer-jar:
    desc: Bigger/outer jar of Reactor core
    type: cadquery
    path: parts/mason-jar-32oz-wide-mouth.py
    implements:
      "m74-jar-threaded-top": [[0, 0, 165], [1, 0, 0], 180]
      # TODO: most probably this should be a new "shimmed" interface
      # together with 2 flanges
      "m80-shaft":
        neck-lower: [[0, 0, 140], [0, 0, 1], 180]
        neck-upper: [[0, 0, 150.5], [0, 0, 1], 180]  
  reactor-core-outer-jar-band:
    desc: Band for bigger/outer jar of Reactor core
    type: cadquery
    path: parts/mason-jar-band-wide-mouth.py
    implements:
      # TODO: a different interface most probably
      "m74-opening":
        lid-place: [[0, 0, 2], [1, 0, 0], 180]
      "m74-jar-threaded-lid": [[0, 0, 5], [1, 0, 0], 180]
  reactor-core-inner-jar:
    desc: Smaller/inner jar of Reactor core
    type: cadquery
    path: parts/mason-jar-6oz-regular-mouth.py
    implements:
      "m60-jar-threaded-top":
        top: [[0, 0, 81], [1, 0, 0], 0]
  reactor-core-inner-jar-band:
    desc: Band for smaller/inner jar of Reactor core
    type: cadquery
    path: parts/mason-jar-band-regular-mouth.py
    implements:
      # TODO: a different interface most probably
      "m60-opening":
        lid-place: [[0, 0, 2], [1, 0, 0], 180]
      "m60-jar-threaded-lid": [[0, 0, 5], [1, 0, 0], 0]
  reactor-core-stir-rod-mount:
    desc: Mount for stirring rod
    type: step
    fileFrom: url
    fileUrl: {{ url }}/reactor-manifold/stirring-mount-v0.1.step
    implements:
      "/pub/std/metric/m:m3-hole-20":
        upper-back: [[67.85, 116.85, 469], [1, 0, 0], 180]
        upper-left: [[86.7, 128, 469], [1, 0, 0], 180]
        upper-right: [[86.95, 106.15, 469], [1, 0, 0], 180]
        bottom-back: [[67.85, 116.85, 459], [1, 0, 0], 0]
        bottom-left: [[86.7, 128, 459], [1, 0, 0], 0]
        bottom-right: [[86.95, 106.15, 459], [1, 0, 0], 0]
                
  # Temperature Exchange Units
  cold-unit-jar:
    desc: Jar for cooling unit
    type: cadquery
    path: parts/mason-jar-32oz-wide-mouth.py
    implements:
      "m74-jar-mouth":
        mouth: [[0, 0, 165], [1, 0, 0], 180]
  cold-unit-jar-band:
    desc: Jar band for cooling unit
    type: cadquery
    path: parts/mason-jar-band-wide-mouth.py
    implements:
      "m74-jar-threaded-lid": [[0, 0, 5], [1, 0, 0], 180]
  cold-unit-lid:
    desc: Lid for cooling unit
    type: step
    fileFrom: url
    fileUrl: {{ url }}/temperature-units/cold-unit-lid-v.1.0.step
    implements:
      "/pub/std/metric/m:m10-thru":
        left-outer: [[-24, 0, 0], [1, 0, 0], 0]
        right-outer: [[24, 0, 0], [1, 0, 0], 0]
      "m74-jar-closing":
        bottom: [[0, 0, 4], [1, 0, 0], 180]
  cold-unit-tube:
    desc: Spiral tube for cooling unit
    type: step
    fileFrom: url
    fileUrl: {{ url }}/temperature-units/cold-unit-tube-v.0.3.step
    implements:
      "/pub/std/metric/m:m10-shaft":
        right: [[-15, 28, 160], [1, 0, 0], 0]
        left: [[-15, -20, 160], [1, 0, 0], 0]
  hot-unit-lid:
    desc: Lid for heating unit
    type: step
    fileFrom: url
    fileUrl: {{ url }}/temperature-units/hot-unit-lid-v.1.0.step

assemblies:
  microlab:
    type: assy
    path: microlab.assy
  control-unit:
    type: assy
    path: control-unit.assy
    parameters:
      profile:
        type: string
        desc: Profile of the control box
        enum: [regular, flat]
        default: flat
      screw_type:
        type: string
        desc: Type of the screws attaching lid to the control box
        enum: [raisedcountersunkovalhead-iso7047, raisedcheesehead-iso7045]
        default: raisedcountersunkovalhead-iso7047
    render:
      svg:
        viewportOrigin: [75, 0, 150]
  reactor-unit-pumps-box:
    type: assy
    path: reactor-unit-pumps-box.assy
    parameters:
      screw_type:
        type: string
        desc: Type of the screws attaching lid to the pumps box
        enum: [raisedcountersunkovalhead-iso7047, raisedcheesehead-iso7045]
        default: raisedcountersunkovalhead-iso7047
  reactor-unit-reactor-stand:
    type: assy
    path: reactor-unit-reactor-stand.assy
    implements:
      "m80-opening":
        core-holder: [[98, 22, 155.5], [1, 0, 0], 0]
  reactor-unit-reactor-core:
    type: assy
    path: reactor-unit-reactor-core.assy
    implements:
      "m80-shaft":
        stand-neck: [[0, 0, -29], [1, 0, 0], 0]
  reactor-unit:
    type: assy
    path: reactor-unit.assy
  heating-unit:
    type: assy
    path: heating-unit.assy
  cooling-unit:
    type: assy
    path: cooling-unit.assy

render:
  svg:
    lineWeight: 1.5
  readme:
